import json
from datetime import datetime
from urllib.parse import quote

from lxml import html

from juriscraper.opinions.united_states.state import ri


class Site(ri.Site):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.court_id = self.__module__
        self.status = "Published"
        self.url="https://www.courts.ri.gov/Courts/SupremeCourt/Pages/published-opinions.aspx#k=#l=1033"
        # self.year_u="https://www.courts.ri.gov/Courts/SupremeCourt/Pages/published-opinions.aspx#Default=%7B%22k%22%3A%22%22%2C%22s%22%3A{}1%2C%22r%22%3A%5B%7B%22n%22%3A%22RIJYear%22%2C%22t%22%3A%5B%22%5C%22%C7%82%C7%82666c6f61743b233{}3{}3{}3{}2e3030303030303030303030%5C%22%22%5D%2C%22o%22%3A%22OR%22%2C%22k%22%3Afalse%2C%22m%22%3A%7B%22%5C%22%C7%82%C7%82666c6f61743b233{}3{}3{}3{}2e3030303030303030303030%5C%22%22%3A%22float%3B%23{}.00000000000%22%7D%7D%5D%7D"
        self.json_url ="https://www.courts.ri.gov/Courts/superiorcourt/_vti_bin/client.svc/ProcessQuery"
        row_limit=500
        self.requestDigest = ""
        self.headers = {
            "Referer": "https://www.courts.ri.gov/Courts/superiorcourt/Pages/decisions-orders.aspx",
        }
        self.data_xml = (f'''<Request xmlns="http://schemas.microsoft.com/sharepoint/clientquery/2009" SchemaVersion="15.0.0.0" LibraryVersion="16.0.0.0" ApplicationName="Javascript Library"><Actions><ObjectPath Id="109" ObjectPathId="108" /><SetProperty Id="110" ObjectPathId="108" Name="ImpressionID"><Parameter Type="String">1287268_-1_1033</Parameter></SetProperty><SetProperty Id="111" ObjectPathId="108" Name="TimeZoneId"><Parameter Type="Number">{row_limit}</Parameter></SetProperty><SetProperty Id="112" ObjectPathId="108" Name="QueryTemplate">
                            <Parameter Type="String">{{SearchBoxQuery}} (ContentType:"RIJOpinion" OR ContentType:"RIJAdministrativeOrder" OR ContentType:"RIJExecutiveOrder" OR ContentType:"RIJDecision" OR ContentType:"RIJMiscellaneousOrder" OR ContentType:"RIJPublishedOrder") AND RIJCourt=Superior</Parameter></SetProperty><ObjectPath Id="114" ObjectPathId="113" /><Method Name="Add" Id="115" ObjectPathId="113"><Parameters><Parameter Type="String">RefinableDate03</Parameter><Parameter Type="Number">1</Parameter></Parameters></Method><SetProperty Id="116" ObjectPathId="108" Name="Culture"><Parameter Type="Number">1033</Parameter></SetProperty><SetProperty Id="117" ObjectPathId="108" Name="RowsPerPage"><Parameter Type="Number">{row_limit}</Parameter></SetProperty><SetProperty Id="118" ObjectPathId="108" Name="RowLimit"><Parameter Type="Number">{row_limit}</Parameter></SetProperty><SetProperty Id="119" ObjectPathId="108" Name="TotalRowsExactMinimum"><Parameter Type="Number">11</Parameter></SetProperty><SetProperty Id="120" ObjectPathId="108" Name="SourceId"><Parameter Type="Guid">{{8413cd39-2156-4e00-b54d-11efd9abdb89}}</Parameter></SetProperty><ObjectPath Id="122" ObjectPathId="121" /><Method Name="SetQueryPropertyValue" Id="123" ObjectPathId="121"><Parameters><Parameter Type="String">SourceName</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">0</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">1</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="String">Local SharePoint Results</Property></Parameter></Parameters></Method><Method Name="SetQueryPropertyValue" Id="124" ObjectPathId="121"><Parameters><Parameter Type="String">SourceLevel</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">0</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">1</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="String">Ssa</Property></Parameter></Parameters></Method><SetProperty Id="125" ObjectPathId="108" Name="Refiners"><Parameter Type="String">RIJYear(deephits=100000,sort=name/descending,filter=15/0/*),ContentType(deephits=100000,sort=name/ascending,filter=15/0/*)</Parameter></SetProperty><ObjectPath Id="127" ObjectPathId="126" /><Method Name="Add" Id="128" ObjectPathId="126"><Parameters><Parameter Type="String">Path</Parameter></Parameters></Method><Method Name="Add" Id="129" ObjectPathId="126"><Parameters><Parameter Type="String">RIJLongTitleOWSMTXT</Parameter></Parameters></Method><Method Name="Add" Id="130" ObjectPathId="126"><Parameters><Parameter Type="String">RIJDateOWSDATE</Parameter></Parameters></Method><Method Name="Add" Id="131" ObjectPathId="126"><Parameters><Parameter Type="String">RIJLongNumberOWSMTXT</Parameter></Parameters></Method><Method Name="Add" Id="132" ObjectPathId="126"><Parameters><Parameter Type="String">RIJCaseSummaryOWSMTXT</Parameter></Parameters></Method><ObjectPath Id="134" ObjectPathId="133" /><Method Name="Add" Id="135" ObjectPathId="133"><Parameters><Parameter Type="String">Title</Parameter></Parameters></Method><Method Name="Add" Id="136" ObjectPathId="133"><Parameters><Parameter Type="String">Path</Parameter></Parameters></Method><Method Name="Add" Id="137" ObjectPathId="133"><Parameters><Parameter Type="String">Author</Parameter></Parameters></Method><Method Name="Add" Id="138" ObjectPathId="133"><Parameters><Parameter Type="String">SectionNames</Parameter></Parameters></Method><Method Name="Add" Id="139" ObjectPathId="133"><Parameters><Parameter Type="String">SiteDescription</Parameter></Parameters></Method><Method Name="SetQueryPropertyValue" Id="140" ObjectPathId="121"><Parameters><Parameter Type="String">CrossGeoQuery</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">0</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">1</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="String">false</Property></Parameter></Parameters></Method><Method Name="SetQueryPropertyValue" Id="141" ObjectPathId="121"><Parameters><Parameter Type="String">ListId</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">0</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">1</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="String">3d112237-a81e-49c6-89e0-8752e2d896df</Property></Parameter></Parameters></Method><Method Name="SetQueryPropertyValue" Id="142" ObjectPathId="121"><Parameters><Parameter Type="String">ListItemId</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">13</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">2</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="Null" /></Parameter></Parameters></Method><SetProperty Id="143" ObjectPathId="108" Name="ResultsUrl"><Parameter Type="String">https://www.courts.ri.gov/Courts/superiorcourt/Pages/decisions-orders.aspx#k=#s=11#l=1033</Parameter></SetProperty><SetProperty Id="144" ObjectPathId="108" Name="BypassResultTypes"><Parameter Type="Boolean">true</Parameter></SetProperty><SetProperty Id="145" ObjectPathId="108" Name="ClientType"><Parameter Type="String">UI</Parameter></SetProperty><Method Name="SetQueryPropertyValue" Id="146" ObjectPathId="121"><Parameters><Parameter Type="String">QuerySession</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">0</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">1</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="String">de287827-c96e-47aa-b7e1-cb97e4957a93</Property></Parameter></Parameters></Method><SetProperty Id="147" ObjectPathId="108" Name="SafeQueryPropertiesTemplateUrl"><Parameter Type="String">querygroup://webroot/Pages/decisions-orders.aspx?groupname=Default</Parameter></SetProperty><SetProperty Id="148" ObjectPathId="108" Name="IgnoreSafeQueryPropertiesTemplateUrl"><Parameter Type="Boolean">false</Parameter></SetProperty><Method Name="SetQueryPropertyValue" Id="149" ObjectPathId="121"><Parameters><Parameter Type="String">QueryDateTimeCulture</Parameter><Parameter TypeId="{{b25ba502-71d7-4ae4-a701-4ca2fb1223be}}"><Property Name="BoolVal" Type="Boolean">false</Property><Property Name="IntVal" Type="Number">1033</Property><Property Name="QueryPropertyValueTypeIndex" Type="Number">2</Property><Property Name="StrArray" Type="Null" /><Property Name="StrVal" Type="Null" /></Parameter></Parameters></Method><ObjectPath Id="151" ObjectPathId="150" /><ExceptionHandlingScope Id="152"><TryScope Id="154"><Method Name="ExecuteQueries" Id="156" ObjectPathId="150"><Parameters>
                            <Parameter Type="Array"><Object Type="String">{self.search_key}</Object></Parameter><Parameter Type="Array"><Object ObjectPathId="108" /></Parameter><Parameter Type="Boolean">true</Parameter></Parameters></Method></TryScope><CatchScope Id="158" /></ExceptionHandlingScope></Actions><ObjectPaths><Constructor Id="108" TypeId="{{80173281-fffd-47b6-9a49-312e06ff8428}}" /><Property Id="113" ParentId="108" Name="SortList" /><Property Id="121" ParentId="108" Name="Properties" /><Property Id="126" ParentId="108" Name="SelectProperties" /><Property Id="133" ParentId="108" Name="HitHighlightedProperties" /><Constructor Id="150" TypeId="{{8d2ac302-db2f-46fe-9015-872b35f15098}}" /></ObjectPaths></Request>''')


    def get_class_name(self):
        return "ri_supr"

    def get_court_name(self):
        return "Rhode Island Superior Court"
